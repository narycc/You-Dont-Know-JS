# 你不知道的JS ： 起步
# 第3章：深入了解“你不知道的JS”

这一系列的内容都是关于什么的呢？简单地说，它是学习JavaScript方方面面，而不是某些人所说的“好的部分”，也不是你要搞定工作的最小量。

认真的程序员在开始写其他语言代码的时候都希望努力学好那些语言的全部或者大部门的内容，但是JS开发者与别人不一样并不会学习JS 的太多的知识。这不是一件好事，我们不应该让这种事情成为榜样。

“你不知道的JS”系列与传统的JS 学习方式形成鲜明对比，你会发现它与其他JS类书籍几乎完全不一样。它挑战你学习的舒适区，遇到的每一个行为引发你更深入的思考“为什么”的问题。你准备好接受挑战了吗？

我将利用最后的这一章节来简要地概括一下这一系列其他书的内容，以及如何在“你不知道的JS”的基础上更有效的建立学习JS 的基础。

## 作用域与闭包

或许你需要快速掌握的一个最重要的基础概念是作用域在JavaScript 是怎样工作的。仅有一些关于作用的模糊传闻概念是不够的。

题为“作用域与闭包”的书开始就揭露了一些常见的误解：JS是一门解释型语言因此不需要被编译。错。

JS 引擎会在代码执行前编译，有时候边执行边编译。因此我们用了解编译器编译代码的方法来更深入地理解它是如何找到变量和函数声明以及如何处理它们的。之后我们会看到JS 变量作用域管理的典型比喻：“提升”。

理解“词法作用域”的关键是我们在你本书最后章节理解探索闭包的基础。闭包或许是所有JS 中最重要的概念，但是如果你还没有牢牢掌握作用域是如何工作的，你也无法掌握闭包。

闭包的一个重要应用是模块化，我们这本书中第2章简要介绍过的。模块化或许是所有JavaScript 中最流行的代码组织方式了，深入理解模块化是优先级最高的任务之一。

## this 与对象原型

函数中出现的this 关键字或许是JavaScript 中最广泛最悠久的难题。完全被误解了。

this 关键字的动态绑定取决于问题中的函数是怎么被执行的，有四个简单的规则理解this，决定this 是如何绑定的。

和this 关键字紧密相关的是对象原型机制，它是一个向上查找的属性链，类似词法作用域中变量是如何被找到的。但是原型中另一个关于JS的极大误解是：仿类和继承的思想。

很不幸，把类和继承带到JavaScript中来可能你会尝试的最糟糕的事情，JavaScript可能会让你误以为它有类似表示类的语法。事实上，原型机制从根本上与类的行为相反。

关键是忽略不匹配假装你正在实现的是继承更好，还是学会掌握对象原型系统实际上是如何工作的更合适。后者成为“行为代理”更合适。

这不仅仅是语法偏好。代理是完全不同更强大的设计模式，它能取代使用类和继承的设计。但是这些关于类和继承的言论肯定会在JavaScript 整个生涯中在别人的博客，书本，会议讨论中到处出现。

我把代理和继承拿出来做对比的言论不是源于我对这门语言和它的语法的不爱，而是渴望能够真正看到利用这门语言能做的事情，并把所有的困惑和阻碍清除掉。

但是关于原型和代理的情况是我在这里会着重讲的。如果你认为你已经掌握了JavaScript 的类和继承，并且已经准备好再看看这些概念，你可以到这一系列的题为“this 与对象原型”书本的第4-6章查看。

## 类型与语法

这一系列的第三个标题的焦点是另一个备受争议的主题：类型转化。或许对于JS开发者来说没有比谈起隐式转换更让人沮丧的啦。

到目前为止世俗观点是隐式强制转换时这门语言的“不好的部分”，应该不惜代价避免之。事实上，这门语言的设计中有一些瑕疵。有一些工具是专门用来扫描代码并当出现转换的时候提醒。

但是转换真的如此让人困惑，如此之坏，如果不可靠，以致你一旦开始使用它你的代码就被判了死刑吗？

我说不是的。1-3章在建立对类型和值是如何的工作的理解之后，第4章从所有角落全面解释转换是如何工作的。我们会看到转化的哪部分会令人震惊，哪部分在花时间学习之后会很有意义。

我不仅仅认为转换是合理的，值得学习的。转换难以置信是那么有用却完全被低估了，你应该在你的代码中使用的工具。转换如果使用得当，不仅仅能正常工作，还能让你的代码更好。那些反对使用转换的人必定会藐视它的位置，但是我相信它是提高你的JS水平的一个关键技能。

你只想追求群众，还是愿意将所有的设想放到一边，从一个新的视角来看待转换？“类型与语法”的内容会改变你的想法。

## 异步与性能

这一系列的前三本书都是围绕这门语言的核心机制，但是第4章在语言机制之上拉出一个分支讨论异步程序管理模式。异步不仅仅对应用性能至关重要，它逐渐变成了易用性和可维护性的至关重要的因素了。

这本书以扫清一些专业术语和概念的混淆开始，比如“异步”，“并行”，“并发”，并深度解释这些概念是怎么应用或者不应用到JS 上的。

然后我们开始研究回调作为开启异步的最原始的方式。但是只有回调对于现代异步编程的需求来说无疑是远远不够的。我们总结了只有回调的代码的两个主要的缺陷： “控制反转IoC” 信任缺失和线性编码能力不足。

为了处理这两个缺陷，ES6 引入了两个新机制：promise 和 generator。

Promise 是包装“未来值”的与时间无关的包装器，它不管它的值是否已经准备好了都允许你操作它。还有，它通过可信任的可组装的promise 机制跟踪回调很好地解决了控制反转的问题。

Generator 引入了执行JS 函数的新模式，generator 可以在出现yield 的地方暂停，之后再恢复执行。这种暂停-恢复机制允许在generator 中书写看似有序的同步的代码但是以异步的方式执行。这样，我们就能解决回调的非线性，非本地跳转的问题，像同步执行一样的代码也更加合理。

promise 和generator 一起使用是“暂停” 大多数JavaScript程序的高效的异步编程模式。事实上，ES7 以及以后的异步改进也都是以此为基础的。要想在异步地世界里高效编程，你需要熟练使用promise 和generator。 

如果promise 和 generator是会让我们的程序运行并发程度更高，在更短的时间内能完成更多的处理的模式，那么JS 还有更多其他的关于性能优化的方面值得探讨。

第5章讨论的主题是程序并行像web worker， 数据并行像SIMD，还有底层的优化技术如ASM.js。第6章从benchmark技术的角度讨论性能优化，包括什么样的性能需要关注，什么可以忽略。

高效地写JavaScript 程序意味着要写出能够打破各种浏览器和其他环境的限制障碍的代码。不仅要是让程序运行还要运行良好需要在这一块做出复杂而详尽的计划并付出很多努力。

“异步与性能”这本书的目的是给你提供写合理高性能的JavaScript 代码时候的工具和技能。

## ES6 与未来

不管到现在为止你觉得你自己掌握了多少关于JavaScript的知识，JavaScript在更新的步伐上永无止境，而且更新的速度越来越快。这个事实也是这一系列的精神暗示，我们要接受永远无法了解JS的所有内容的事实，因为一旦你掌握了全部，新的东西又出现你要学习的知识列表中了。

 这一本书讲述这门语言的短期和中期发展趋势，不只有一些我们ES6 中已知的知识，还有未来可能出现的东西。
 
 在写这一系列内容的时候已经JavaScript 的ES6已经被采用，所以最开始关注的已经大多是ES5的知识了。现在我们把注意力转向ES6, ES7...

在写这本书的时候，ES6 的制定差不多接近尾声，“ES6 与未来” 把ES6 的具体内容分成几个主要的目录，包括新语法，新数据结构（集合），新处理能力和API。本书内容按照不同的详细程度包含了ES6的每一个新特性，包括回顾之前其他书本中提到的细节。

结构，默认参数值，symbol, 简洁的方法，计算属性，剪头函数，块作用域，promise,generator,iterator,模块化，代理，弱Map，还有很多很多都是我们在ES6翘首以盼的。ES6强力出击。

这本书的第一部分是所有你需要学习的内容的导图，这些都是为未来这几年要探索和书写最新的JavaScript做准备。

这本书的后半部分把注意力转向展望不远的未来JavaScript 可能会发展的内容。ES6 以后JS 的发展更可能是按照特性更新而更新，而不是按照版本更新，这是我们最重要的领悟，这意味着我们可以预料到这些就在眼前的未来比想象中更快到来。

JavaScript前途光明，难道我们不该即刻学习吗？

## 回顾

“你不知道的JS”这一系列的书用于倡导所有的JS开发者都应该学习这门伟大语言的全部。任何人的观点，框架的假设，项目截止时间都不能成为你不好好学习并深入了解JavaScript 的理由。

我们专注于这门语言的每一个重要领域，致力于用一本短小却精细的书来全面探索所有可能你认为你知道但实际不完全知道的知识内容。

“你不知道的JS” 不是一套评论书也不是一套咨询书。它让我们认识到所有的人，包括我自己都必须达成共识: 学习JavaScript 不是一个终极目标，而是一个过程。我们现在不懂JavaScript 但是我们终会明白。
